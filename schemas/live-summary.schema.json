{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/nbardy/oompa_loompas/schemas/live-summary.schema.json",
  "title": "OompaLiveSummary",
  "description": "Live summary snapshot written after each iteration. File: runs/{swarm-id}/live-summary.json",
  "type": "object",
  "required": ["swarm-id", "updated-at", "workers"],
  "properties": {
    "swarm-id": {
      "type": "string",
      "description": "Unique identifier for this swarm run"
    },
    "updated-at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO-8601 instant of the last update"
    },
    "workers": {
      "type": "object",
      "description": "Map from worker-id to its latest metrics snapshot",
      "additionalProperties": {
        "type": "object",
        "description": "Per-worker live metrics (base metrics map plus iteration/status/updated-at)",
        "required": ["merges", "rejections", "errors", "recycled", "review-rounds-total", "iteration", "status", "updated-at"],
        "properties": {
          "merges": { "type": "integer", "minimum": 0 },
          "rejections": { "type": "integer", "minimum": 0 },
          "errors": { "type": "integer", "minimum": 0 },
          "recycled": { "type": "integer", "minimum": 0 },
          "review-rounds-total": { "type": "integer", "minimum": 0 },
          "iteration": { "type": "integer", "minimum": 1 },
          "status": {
            "type": "string",
            "description": "Outcome of the most recent iteration",
            "enum": ["merged", "rejected", "error", "done", "executor-done", "no-changes", "working"]
          },
          "updated-at": {
            "type": "string",
            "format": "date-time",
            "description": "ISO-8601 instant when this worker's metrics were last updated"
          }
        }
      }
    }
  },
  "additionalProperties": false
}
